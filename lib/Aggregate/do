#!/bin/bash

while test -n "$1"; do
    arg="$1" && shift
    if test $arg == --fmt ; then
        fmt=$1 && shift
    elif test $arg == --sleep ; then
        sleep=$1 && shift
    elif test "${arg:0:1}" == -; then
        echo unknown argument: $arg >&2
        exit 1
    else
        method="$arg"
        break
    fi
done
test -n "$method" || method=show

unset order
for p in ${TOB_search_paths//:/ }; do
    test -e "$p/@order" && order="$p/@order" && break
    test -e "$p/.@order" && order="$p/.@order" && break
done

if test -n "$order"; then
    order=$(<$order)
else
    for ob in *; do 
        test $ob == ^ || test $ob == .^ && continue
        test -d $ob/^ && order="$order $ob"
    done
fi

for ob in $order; do
  # test -n "$fmt" && printf "$fmt" $ob
    printf "\n%s\n" "$ob.$method $*"
    tob $ob.$method "$@"
    test -n "$sleep" && sleep $sleep
done

